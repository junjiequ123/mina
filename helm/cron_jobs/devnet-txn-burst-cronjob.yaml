# kubectl apply -f helm/cron_jobs/devnet-txn-burst-cronjob.yaml
# the above command, with this accompanying file, needs only be run once.  it does not get run in CI.  this file is provided here for future reference
# make sure you're in devnet2
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: devnet-txn-burst-cronjob
spec:
  concurrencyPolicy: Replace
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - command:
            - /bin/bash
            - -c
            - '
mkdir /tmpkeys;
chmod 700 /tmpkeys;
cp /keys/key /tmpkeys;
chmod 600 /tmpkeys/key;
export MINA_PRIVKEY_PASS="naughty blue worm";
echo $MINA_PRIVKEY_PASS;
./_build/default/src/app/batch_generate_keys/batch_generate_keys.exe gen-there-and-back-txns --num-accts 1 --num-txn-per-acct 10 --origin-sender-sk-path /tmpkeys/key > txn_burst.sh;
chmod 777 txn_burst.sh;

echo "ran batch gen keys";
cat txn_burst.sh;
./txn_burst.sh;

while true; do echo looping; sleep 10; done;
            '
            
            env:
            - name: MINA_PRIVKEY_PASS
              value: ""
            - name: GCLOUD_KEYFILE
              value: /gcloud/keyfile.json
            image: gcr.io/o1labs-192920/mina-txn-burst-app@sha256:b16036ec87cb69e983df53e1473743247520f1ad46fd5891df71ca436f385cc9
            imagePullPolicy: IfNotPresent
            name: devnet-txn-burst-cronjob
            resources: {}
            terminationMessagePath: /dev/termination-log
            terminationMessagePolicy: File
            volumeMounts:
            - mountPath: /keys/
              name: private-keys
          dnsPolicy: ClusterFirst
          restartPolicy: Never
          schedulerName: default-scheduler
          securityContext: {}
          terminationGracePeriodSeconds: 30
          volumes: [
            {
              "name": "private-keys",
              "secret": {
                "defaultMode": 0600,
                "items": [
                  {
                    "key": "key",
                    "path": "key"
                  },
                  {
                    "key": "pub",
                    "path": "key.pub"
                  }
                ],
                "secretName": "online-whale-account-1-key"
              }
            }
          ]
  schedule: 0 0 * * *
  successfulJobsHistoryLimit: 3
  suspend: false
